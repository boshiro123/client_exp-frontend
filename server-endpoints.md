# Необходимые серверные эндпоинты для работы с опросниками

## 1. GET /api/surveys

**Описание:** Получение списка всех опросников текущего пользователя с пагинацией.

**Параметры запроса:**

- `page` (int, по умолчанию: 0) - номер страницы
- `size` (int, по умолчанию: 10) - размер страницы
- `status` (string, опционально) - фильтр по статусу (DRAFT, ACTIVE, COMPLETED)

**Ответ (200 OK):**

```json
{
  "content": [
    {
      "id": 1,
      "title": "Название опросника",
      "description": "Описание опросника",
      "status": "ACTIVE",
      "startDate": "2023-05-01",
      "endDate": "2023-12-31",
      "createdAt": "2023-04-20 15:30:45",
      "updatedAt": "2023-04-25 10:15:20",
      "questions": [
        {
          "id": 1,
          "text": "Укажите ваш возраст",
          "type": "SINGLE_CHOICE",
          "required": true,
          "category": "Демографическая информация",
          "orderNumber": 1,
          "options": [
            "До 18 лет",
            "18–25 лет",
            "26–35 лет",
            "36–45 лет",
            "46–60 лет",
            "60+ лет"
          ]
        }
        // Другие вопросы...
      ],
      "user": {
        "id": 1,
        "username": "manager1",
        "email": "manager@example.com"
      }
    }
    // Другие опросники...
  ],
  "totalElements": 24,
  "totalPages": 3,
  "size": 10,
  "number": 0
}
```

## 2. POST /api/surveys

**Описание:** Создание нового опросника.

**Тело запроса:**

```json
{
  "title": "Название опросника",
  "description": "Описание опросника",
  "status": "DRAFT", // DRAFT, ACTIVE, COMPLETED
  "startDate": "2023-05-01", // опционально
  "endDate": "2023-12-31", // опционально
  "questions": [
    {
      "text": "Укажите ваш возраст",
      "type": "SINGLE_CHOICE",
      "required": true,
      "category": "Демографическая информация",
      "orderNumber": 1,
      "options": [
        "До 18 лет",
        "18–25 лет",
        "26–35 лет",
        "36–45 лет",
        "46–60 лет",
        "60+ лет"
      ]
    }
    // Другие вопросы...
  ]
}
```

**Ответ (201 Created):**

```json
{
  "id": 1,
  "title": "Название опросника",
  "description": "Описание опросника",
  "status": "DRAFT",
  "startDate": "2023-05-01",
  "endDate": "2023-12-31",
  "createdAt": "2023-04-28 14:23:55",
  "updatedAt": "2023-04-28 14:23:55",
  "questions": [
    // Объекты вопросов с присвоенными ID
  ],
  "user": {
    "id": 1,
    "username": "manager1",
    "email": "manager@example.com"
  }
}
```

## 3. GET /api/surveys/{id}

**Описание:** Получение детальной информации о конкретном опроснике.

**Параметры пути:**

- `id` (long) - идентификатор опросника

**Ответ (200 OK):**

```json
{
  "id": 1,
  "title": "Название опросника",
  "description": "Описание опросника",
  "status": "ACTIVE",
  "startDate": "2023-05-01",
  "endDate": "2023-12-31",
  "createdAt": "2023-04-20 15:30:45",
  "updatedAt": "2023-04-25 10:15:20",
  "questions": [
    {
      "id": 1,
      "text": "Укажите ваш возраст",
      "type": "SINGLE_CHOICE",
      "required": true,
      "category": "Демографическая информация",
      "orderNumber": 1,
      "options": [
        "До 18 лет",
        "18–25 лет",
        "26–35 лет",
        "36–45 лет",
        "46–60 лет",
        "60+ лет"
      ]
    }
    // Другие вопросы...
  ],
  "user": {
    "id": 1,
    "username": "manager1",
    "email": "manager@example.com"
  }
}
```

**Ошибка (404 Not Found):**

```json
{
  "timestamp": "2023-04-28T14:30:15.123Z",
  "status": 404,
  "error": "Not Found",
  "message": "Опросник с ID 1 не найден",
  "path": "/api/surveys/1"
}
```

## 4. PUT /api/surveys/{id}

**Описание:** Обновление существующего опросника.

**Параметры пути:**

- `id` (long) - идентификатор опросника

**Тело запроса:** Аналогично телу запроса для создания опросника (POST /api/surveys)

**Ответ (200 OK):** Обновленный объект опросника, аналогичный ответу для GET /api/surveys/{id}

**Ошибка (404 Not Found):** Если опросник не найден
**Ошибка (403 Forbidden):** Если у пользователя нет прав на редактирование этого опросника

## 5. DELETE /api/surveys/{id}

**Описание:** Удаление опросника.

**Параметры пути:**

- `id` (long) - идентификатор опросника

**Ответ (204 No Content):** Пустой ответ при успешном удалении

**Ошибка (404 Not Found):** Если опросник не найден
**Ошибка (403 Forbidden):** Если у пользователя нет прав на удаление этого опросника

## 6. PATCH /api/surveys/{id}/status

**Описание:** Изменение статуса опросника.

**Параметры пути:**

- `id` (long) - идентификатор опросника

**Тело запроса:**

```json
{
  "status": "ACTIVE" // DRAFT, ACTIVE, COMPLETED
}
```

**Ответ (200 OK):**

```json
{
  "id": 1,
  "title": "Название опросника",
  "status": "ACTIVE",
  "updatedAt": "2023-04-28 15:45:30"
  // Другие поля опросника...
}
```

**Ошибка (404 Not Found):** Если опросник не найден
**Ошибка (403 Forbidden):** Если у пользователя нет прав на изменение этого опросника
**Ошибка (400 Bad Request):** Если указан недопустимый статус

## Дополнительные рекомендации по реализации сервера

1. **Валидация:**

   - Проверять, что первые три вопроса соответствуют требуемым типам (возраст, пол, профессия)
   - Валидировать даты (endDate должна быть позже startDate)
   - Проверять, что статус имеет одно из допустимых значений

2. **Безопасность:**

   - Все эндпоинты должны быть защищены аутентификацией
   - Проверять, что пользователь имеет доступ к опросникам (является их владельцем или администратором)
   - Использовать параметризованные запросы для предотвращения SQL-инъекций

3. **Обработка ошибок:**

   - Возвращать понятные сообщения об ошибках с соответствующими HTTP-статусами
   - Логировать ошибки на сервере для дальнейшего анализа

4. **Производительность:**
   - Использовать пагинацию для списка опросников
   - Оптимизировать запросы к базе данных для быстрой загрузки

{"ast":null,"code":"import axios from \"axios\";\nconst API_URL = \"http://localhost:8080/api\";\nexport const authService = {\n  async login(credentials) {\n    try {\n      const response = await axios.post(`${API_URL}/auth/login`, credentials);\n      if (response.data.user && response.data.user.role === \"PENDING\") {\n        localStorage.setItem(\"loginError\", \"Ваша учетная запись ожидает одобрения администратором. Проверьте электронную почту для получения дальнейших инструкций.\");\n        throw new Error(\"Учетная запись ожидает одобрения\");\n      }\n      if (response.data.token) {\n        localStorage.setItem(\"token\", response.data.token);\n        localStorage.setItem(\"user\", JSON.stringify(response.data.user));\n        localStorage.removeItem(\"loginError\");\n      }\n      return response.data;\n    } catch (error) {\n      console.error(\"Login error:\", error);\n      if (error.response) {\n        var _error$response$data, _error$response$data$;\n        if (error.response.status === 403 && (_error$response$data = error.response.data) !== null && _error$response$data !== void 0 && (_error$response$data$ = _error$response$data.message) !== null && _error$response$data$ !== void 0 && _error$response$data$.includes(\"одобрения\")) {\n          localStorage.setItem(\"loginError\", \"Ваша учетная запись ожидает одобрения администратором\");\n        } else {\n          var _error$response$data2;\n          const errorMsg = ((_error$response$data2 = error.response.data) === null || _error$response$data2 === void 0 ? void 0 : _error$response$data2.message) || (error.response.status === 401 ? \"Неверный email или пароль\" : \"Произошла ошибка при авторизации\");\n          localStorage.setItem(\"loginError\", errorMsg);\n        }\n      } else if (error.request) {\n        localStorage.setItem(\"loginError\", \"Сервер не отвечает. Проверьте подключение к интернету.\");\n      } else {\n        localStorage.setItem(\"loginError\", \"Произошла ошибка при отправке запроса\");\n      }\n      throw error;\n    }\n  },\n  async register(userData) {\n    try {\n      const response = await axios.post(`${API_URL}/auth/register`, userData);\n      return {\n        ...response.data,\n        success: true,\n        pendingApproval: true\n      };\n    } catch (error) {\n      console.error(\"Registration error:\", error);\n      throw error;\n    }\n  },\n  logout() {\n    localStorage.removeItem(\"token\");\n    localStorage.removeItem(\"user\");\n    localStorage.removeItem(\"loginError\");\n    try {\n      axios.post(`${API_URL}/auth/logout`).catch(err => {\n        console.warn(\"Logout API error:\", err);\n      });\n    } catch (e) {\n      console.warn(\"Logout client error:\", e);\n    }\n  },\n  getCurrentUser() {\n    const userStr = localStorage.getItem(\"user\");\n    if (userStr) {\n      try {\n        return JSON.parse(userStr);\n      } catch (e) {\n        console.error(\"Error parsing user data:\", e);\n        this.logout();\n        return null;\n      }\n    }\n    return null;\n  },\n  getToken() {\n    return localStorage.getItem(\"token\");\n  },\n  isAuthenticated() {\n    return !!this.getToken();\n  },\n  async validateToken() {\n    try {\n      const response = await axios.get(`${API_URL}/auth/validate`);\n      return response.data.valid;\n    } catch (error) {\n      console.error(\"Token validation error:\", error);\n      if (error.response && error.response.status === 401) {\n        this.logout();\n      }\n      return false;\n    }\n  }\n};\naxios.interceptors.request.use(config => {\n  const token = authService.getToken();\n  if (token) {\n    config.headers[\"Authorization\"] = `Bearer ${token}`;\n  }\n  return config;\n}, error => {\n  return Promise.reject(error);\n});\naxios.interceptors.response.use(response => {\n  return response;\n}, error => {\n  if (error.response && error.response.status === 401) {\n    const currentPath = window.location.pathname;\n    if (currentPath !== \"/login\" && currentPath !== \"/register\") {\n      localStorage.setItem(\"redirectAfterLogin\", currentPath);\n    }\n    authService.logout();\n    if (currentPath !== \"/login\") {\n      window.location.href = \"/login\";\n    }\n  }\n  return Promise.reject(error);\n});","map":{"version":3,"names":["axios","API_URL","authService","login","credentials","response","post","data","user","role","localStorage","setItem","Error","token","JSON","stringify","removeItem","error","console","_error$response$data","_error$response$data$","status","message","includes","_error$response$data2","errorMsg","request","register","userData","success","pendingApproval","logout","catch","err","warn","e","getCurrentUser","userStr","getItem","parse","getToken","isAuthenticated","validateToken","get","valid","interceptors","use","config","headers","Promise","reject","currentPath","window","location","pathname","href"],"sources":["/Users/shirokiy/Desktop/Repositories/Дипломы/ClientExp/client_exp-frontend/src/api/auth.js"],"sourcesContent":["import axios from \"axios\"\n\nconst API_URL = \"http://localhost:8080/api\"\n\nexport const authService = {\n  async login(credentials) {\n    try {\n      const response = await axios.post(`${API_URL}/auth/login`, credentials)\n\n      if (response.data.user && response.data.user.role === \"PENDING\") {\n        localStorage.setItem(\n          \"loginError\",\n          \"Ваша учетная запись ожидает одобрения администратором. Проверьте электронную почту для получения дальнейших инструкций.\"\n        )\n        throw new Error(\"Учетная запись ожидает одобрения\")\n      }\n\n      if (response.data.token) {\n        localStorage.setItem(\"token\", response.data.token)\n        localStorage.setItem(\"user\", JSON.stringify(response.data.user))\n        localStorage.removeItem(\"loginError\")\n      }\n      return response.data\n    } catch (error) {\n      console.error(\"Login error:\", error)\n      if (error.response) {\n        if (\n          error.response.status === 403 &&\n          error.response.data?.message?.includes(\"одобрения\")\n        ) {\n          localStorage.setItem(\n            \"loginError\",\n            \"Ваша учетная запись ожидает одобрения администратором\"\n          )\n        } else {\n          const errorMsg =\n            error.response.data?.message ||\n            (error.response.status === 401\n              ? \"Неверный email или пароль\"\n              : \"Произошла ошибка при авторизации\")\n          localStorage.setItem(\"loginError\", errorMsg)\n        }\n      } else if (error.request) {\n        localStorage.setItem(\n          \"loginError\",\n          \"Сервер не отвечает. Проверьте подключение к интернету.\"\n        )\n      } else {\n        localStorage.setItem(\n          \"loginError\",\n          \"Произошла ошибка при отправке запроса\"\n        )\n      }\n      throw error\n    }\n  },\n\n  async register(userData) {\n    try {\n      const response = await axios.post(`${API_URL}/auth/register`, userData)\n      return {\n        ...response.data,\n        success: true,\n        pendingApproval: true,\n      }\n    } catch (error) {\n      console.error(\"Registration error:\", error)\n      throw error\n    }\n  },\n\n  logout() {\n    localStorage.removeItem(\"token\")\n    localStorage.removeItem(\"user\")\n    localStorage.removeItem(\"loginError\")\n    try {\n      axios.post(`${API_URL}/auth/logout`).catch(err => {\n        console.warn(\"Logout API error:\", err)\n      })\n    } catch (e) {\n      console.warn(\"Logout client error:\", e)\n    }\n  },\n\n  getCurrentUser() {\n    const userStr = localStorage.getItem(\"user\")\n    if (userStr) {\n      try {\n        return JSON.parse(userStr)\n      } catch (e) {\n        console.error(\"Error parsing user data:\", e)\n        this.logout()\n        return null\n      }\n    }\n    return null\n  },\n\n  getToken() {\n    return localStorage.getItem(\"token\")\n  },\n\n  isAuthenticated() {\n    return !!this.getToken()\n  },\n\n  async validateToken() {\n    try {\n      const response = await axios.get(`${API_URL}/auth/validate`)\n      return response.data.valid\n    } catch (error) {\n      console.error(\"Token validation error:\", error)\n      if (error.response && error.response.status === 401) {\n        this.logout()\n      }\n      return false\n    }\n  },\n}\n\naxios.interceptors.request.use(\n  config => {\n    const token = authService.getToken()\n    if (token) {\n      config.headers[\"Authorization\"] = `Bearer ${token}`\n    }\n    return config\n  },\n  error => {\n    return Promise.reject(error)\n  }\n)\n\naxios.interceptors.response.use(\n  response => {\n    return response\n  },\n  error => {\n    if (error.response && error.response.status === 401) {\n      const currentPath = window.location.pathname\n      if (currentPath !== \"/login\" && currentPath !== \"/register\") {\n        localStorage.setItem(\"redirectAfterLogin\", currentPath)\n      }\n      authService.logout()\n      if (currentPath !== \"/login\") {\n        window.location.href = \"/login\"\n      }\n    }\n    return Promise.reject(error)\n  }\n)\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}
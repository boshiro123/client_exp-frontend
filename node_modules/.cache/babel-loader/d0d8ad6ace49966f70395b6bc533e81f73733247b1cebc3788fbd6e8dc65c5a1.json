{"ast":null,"code":"import axios from \"axios\";\nconst API_URL = \"http://localhost:8080/api\";\nexport const authService = {\n  async login(credentials) {\n    try {\n      const response = await axios.post(`${API_URL}/auth/login`, credentials);\n      if (response.data.token) {\n        localStorage.setItem(\"token\", response.data.token);\n        localStorage.setItem(\"user\", JSON.stringify(response.data.user));\n        // Удаляем сохраненные ошибки, если они были\n        localStorage.removeItem(\"loginError\");\n      }\n      return response.data;\n    } catch (error) {\n      console.error(\"Login error:\", error);\n      // Если страница обновляется, сохраняем ошибку в localStorage\n      if (error.response) {\n        var _error$response$data;\n        const errorMsg = ((_error$response$data = error.response.data) === null || _error$response$data === void 0 ? void 0 : _error$response$data.message) || (error.response.status === 401 ? \"Неверный email или пароль\" : \"Произошла ошибка при авторизации\");\n        localStorage.setItem(\"loginError\", errorMsg);\n      } else if (error.request) {\n        localStorage.setItem(\"loginError\", \"Сервер не отвечает. Проверьте подключение к интернету.\");\n      } else {\n        localStorage.setItem(\"loginError\", \"Произошла ошибка при отправке запроса\");\n      }\n      throw error;\n    }\n  },\n  async register(userData) {\n    try {\n      const response = await axios.post(`${API_URL}/auth/register`, userData);\n      if (response.data.token) {\n        localStorage.setItem(\"token\", response.data.token);\n        localStorage.setItem(\"user\", JSON.stringify(response.data.user));\n      }\n      return response.data;\n    } catch (error) {\n      console.error(\"Registration error:\", error);\n      throw error;\n    }\n  },\n  logout() {\n    // Удаляем токен и данные пользователя\n    localStorage.removeItem(\"token\");\n    localStorage.removeItem(\"user\");\n    localStorage.removeItem(\"loginError\");\n\n    // Пытаемся сделать запрос на сервер для выхода\n    try {\n      axios.post(`${API_URL}/auth/logout`).catch(err => {\n        console.warn(\"Logout API error:\", err);\n      });\n    } catch (e) {\n      console.warn(\"Logout client error:\", e);\n    }\n  },\n  getCurrentUser() {\n    const userStr = localStorage.getItem(\"user\");\n    if (userStr) {\n      try {\n        return JSON.parse(userStr);\n      } catch (e) {\n        console.error(\"Error parsing user data:\", e);\n        this.logout();\n        return null;\n      }\n    }\n    return null;\n  },\n  getToken() {\n    return localStorage.getItem(\"token\");\n  },\n  isAuthenticated() {\n    return !!this.getToken();\n  },\n  // Метод для проверки валидности токена на сервере\n  async validateToken() {\n    try {\n      const response = await axios.get(`${API_URL}/auth/validate`);\n      return response.data.valid;\n    } catch (error) {\n      console.error(\"Token validation error:\", error);\n      // Если токен недействителен, выполняем выход\n      if (error.response && error.response.status === 401) {\n        this.logout();\n      }\n      return false;\n    }\n  }\n};\n\n// Настраиваем axios для автоматического добавления токена к запросам\naxios.interceptors.request.use(config => {\n  const token = authService.getToken();\n  if (token) {\n    config.headers[\"Authorization\"] = `Bearer ${token}`;\n  }\n  return config;\n}, error => {\n  return Promise.reject(error);\n});\n\n// Обработка ответов с сервера (например, для перенаправления при истечении токена)\naxios.interceptors.response.use(response => {\n  return response;\n}, error => {\n  if (error.response && error.response.status === 401) {\n    // Сохраняем текущий URL, чтобы вернуться после авторизации\n    const currentPath = window.location.pathname;\n    if (currentPath !== \"/login\" && currentPath !== \"/register\") {\n      localStorage.setItem(\"redirectAfterLogin\", currentPath);\n    }\n\n    // Выход при недействительном токене\n    authService.logout();\n\n    // Если пользователь не на странице логина, перенаправляем\n    if (currentPath !== \"/login\") {\n      window.location.href = \"/login\";\n    }\n  }\n  return Promise.reject(error);\n});","map":{"version":3,"names":["axios","API_URL","authService","login","credentials","response","post","data","token","localStorage","setItem","JSON","stringify","user","removeItem","error","console","_error$response$data","errorMsg","message","status","request","register","userData","logout","catch","err","warn","e","getCurrentUser","userStr","getItem","parse","getToken","isAuthenticated","validateToken","get","valid","interceptors","use","config","headers","Promise","reject","currentPath","window","location","pathname","href"],"sources":["/Users/shirokiy/Desktop/Repositories/Дипломы/ClientExp/client_exp-frontend/src/api/auth.js"],"sourcesContent":["import axios from \"axios\"\n\nconst API_URL = \"http://localhost:8080/api\"\n\nexport const authService = {\n  async login(credentials) {\n    try {\n      const response = await axios.post(`${API_URL}/auth/login`, credentials)\n      if (response.data.token) {\n        localStorage.setItem(\"token\", response.data.token)\n        localStorage.setItem(\"user\", JSON.stringify(response.data.user))\n        // Удаляем сохраненные ошибки, если они были\n        localStorage.removeItem(\"loginError\")\n      }\n      return response.data\n    } catch (error) {\n      console.error(\"Login error:\", error)\n      // Если страница обновляется, сохраняем ошибку в localStorage\n      if (error.response) {\n        const errorMsg =\n          error.response.data?.message ||\n          (error.response.status === 401\n            ? \"Неверный email или пароль\"\n            : \"Произошла ошибка при авторизации\")\n        localStorage.setItem(\"loginError\", errorMsg)\n      } else if (error.request) {\n        localStorage.setItem(\n          \"loginError\",\n          \"Сервер не отвечает. Проверьте подключение к интернету.\"\n        )\n      } else {\n        localStorage.setItem(\n          \"loginError\",\n          \"Произошла ошибка при отправке запроса\"\n        )\n      }\n      throw error\n    }\n  },\n\n  async register(userData) {\n    try {\n      const response = await axios.post(`${API_URL}/auth/register`, userData)\n      if (response.data.token) {\n        localStorage.setItem(\"token\", response.data.token)\n        localStorage.setItem(\"user\", JSON.stringify(response.data.user))\n      }\n      return response.data\n    } catch (error) {\n      console.error(\"Registration error:\", error)\n      throw error\n    }\n  },\n\n  logout() {\n    // Удаляем токен и данные пользователя\n    localStorage.removeItem(\"token\")\n    localStorage.removeItem(\"user\")\n    localStorage.removeItem(\"loginError\")\n\n    // Пытаемся сделать запрос на сервер для выхода\n    try {\n      axios.post(`${API_URL}/auth/logout`).catch(err => {\n        console.warn(\"Logout API error:\", err)\n      })\n    } catch (e) {\n      console.warn(\"Logout client error:\", e)\n    }\n  },\n\n  getCurrentUser() {\n    const userStr = localStorage.getItem(\"user\")\n    if (userStr) {\n      try {\n        return JSON.parse(userStr)\n      } catch (e) {\n        console.error(\"Error parsing user data:\", e)\n        this.logout()\n        return null\n      }\n    }\n    return null\n  },\n\n  getToken() {\n    return localStorage.getItem(\"token\")\n  },\n\n  isAuthenticated() {\n    return !!this.getToken()\n  },\n\n  // Метод для проверки валидности токена на сервере\n  async validateToken() {\n    try {\n      const response = await axios.get(`${API_URL}/auth/validate`)\n      return response.data.valid\n    } catch (error) {\n      console.error(\"Token validation error:\", error)\n      // Если токен недействителен, выполняем выход\n      if (error.response && error.response.status === 401) {\n        this.logout()\n      }\n      return false\n    }\n  },\n}\n\n// Настраиваем axios для автоматического добавления токена к запросам\naxios.interceptors.request.use(\n  config => {\n    const token = authService.getToken()\n    if (token) {\n      config.headers[\"Authorization\"] = `Bearer ${token}`\n    }\n    return config\n  },\n  error => {\n    return Promise.reject(error)\n  }\n)\n\n// Обработка ответов с сервера (например, для перенаправления при истечении токена)\naxios.interceptors.response.use(\n  response => {\n    return response\n  },\n  error => {\n    if (error.response && error.response.status === 401) {\n      // Сохраняем текущий URL, чтобы вернуться после авторизации\n      const currentPath = window.location.pathname\n      if (currentPath !== \"/login\" && currentPath !== \"/register\") {\n        localStorage.setItem(\"redirectAfterLogin\", currentPath)\n      }\n\n      // Выход при недействительном токене\n      authService.logout()\n\n      // Если пользователь не на странице логина, перенаправляем\n      if (currentPath !== \"/login\") {\n        window.location.href = \"/login\"\n      }\n    }\n    return Promise.reject(error)\n  }\n)\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}